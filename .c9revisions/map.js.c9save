{"ts":1359153720713,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var map;\nvar infowindow;\nvar geocoder;\nvar directionsService;\nvar directionsDisplay;\nvar trekStops = [];\nvar suggestedStops = [];\nvar startIndex;\nvar startList;\nvar endIndex;\nvar endList;\n        \n\n\nfunction place_submit(){\n    var desiredLoc = document.getElementById('place').value;\n    //alert(desiredLoc);\n    \n    geocoder.geocode({'address':desiredLoc}, function(results, status){\n        if (status == google.maps.GeocoderStatus.OK) {\n            \n            map = new google.maps.Map(document.getElementById('map'), {\n                mapTypeId: google.maps.MapTypeId.ROADMAP,\n                center: results[0].geometry.location,\n                zoom: 14\n            });\n            \n            directionsDisplay.setMap(map);\n            \n            var request = {\n              location: results[0].geometry.location,\n              radius: 800,\n              types: ['museum', 'park', 'aquarium', 'amusement_park', 'art_gallery', 'cafe', 'cemetery', 'bakery', 'establishment', 'zoo' ]\n            };\n        \n            infowindow = new google.maps.InfoWindow();\n            var service = new google.maps.places.PlacesService(map);\n            service.nearbySearch(request, callback);\n        }\n        else {\n            alert(\"Geocode was not successful for the following reason: \" + status);\n        }\n                    \n    });\n}\n\nfunction initialize() {\n    geocoder = new google.maps.Geocoder();\n    directionsService = new google.maps.DirectionsService();\n    directionsDisplay = new google.maps.DirectionsRenderer({\n        suppressMarkers: false,\n        draggable: false\n    });\n    \n    var boston = new google.maps.LatLng(42.3583,-71.0603);\n    \n    map = new google.maps.Map(document.getElementById('map'), {\n        mapTypeId: google.maps.MapTypeId.ROADMAP,\n        center: boston,\n        zoom: 14\n    });\n    \n}\n\nfunction callback(results, status) {\n    if (status == google.maps.places.PlacesServiceStatus.OK) {\n        \n        $(\"#trip\").html('');\n        $(\"#attractions\").html('');\n        trekStops = [];\n        suggestedStops = [];\n        \n        //Suggest Top 6 Attractions as Trek Stops\n        for (var i = 0; i < 6; i++) {\n            //createMarker(results[i]);\n            var newAttr = $(\"<div>\").addClass(\"attraction_trip\");\n            var attrIcon = $(\"<img>\").addClass(\"attraction_icon_home\");\n            var attrName = $(\"<div>\").addClass(\"attraction_name\").html(results[i].name);\n            attrIcon.attr(\"src\", results[i].icon);\n            newAttr.append(attrIcon);\n            newAttr.append(attrName);\n            $(\"#trip\").append(newAttr);\n            trekStops.push(results[i]);\n        }\n        \n        //Put rest of attractions in Suggested Stops\n        for (var j = 7; j < results.length; j++) {\n            var newAttr = $(\"<div>\").addClass(\"attraction_suggested\");\n            var attrIcon = $(\"<img>\").addClass(\"attraction_icon_home\");\n            var attrName = $(\"<div>\").addClass(\"attraction_name\").html(results[j].name);\n            attrIcon.attr(\"src\", results[j].icon);\n            newAttr.append(attrIcon);\n            newAttr.append(attrName);\n            $(\"#attractions\").append(newAttr);\n            suggestedStops.push(results[j]);\n        }\n        \n        \n        //Add and remove stops on click and replan route\n        //$(\".attraction_trip\").click(function(event){\n        //   var attrIndex = $(this).parent().children().index(this);\n        //    console.log($(this).attr(\"class\"));\n        //    if ($(this).attr(\"class\") === \"attraction_trip\"){\n        //        $(\"#attractions\").append(this);\n        //        var attr = trekStops.splice(attrIndex,1);\n        //        suggestedStops.push(attr[0]);\n        //    }\n        //    else {\n        //        $(\"#trip\").append(this);\n        //        var attr = suggestedStops.splice(attrIndex,1);\n        //        trekStops.push(attr[0]);\n        //    }\n        //    $(this).addClass(\"attraction_suggested\");\n        //    $(this).removeClass(\"attraction_trip\");\n        //    \n        //    getDirections(trekStops, false);\n        //});\n        \n        //$(\".attraction_suggested\").click(function(event){\n        //    var attrIndex = $(this).parent().children().index(this);\n        //    console.log($(this).attr(\"class\"));\n        //    if ($(this).attr(\"class\") === \"attraction_trip\"){\n        //        $(\"#attractions\").append(this);               \n        //        var attr = trekStops.splice(attrIndex,1);\n        //        suggestedStops.push(attr[0]);\n        //    }\n        //    else {\n        //        $(\"#trip\").append(this);\n        //        var attr = suggestedStops.splice(attrIndex,1);\n        //        trekStops.push(attr[0]);\n        //    }\n        //    $(this).addClass(\"attraction_trip\");\n        //    $(this).removeClass(\"attraction_suggested\");\n\n        //    getDirections(trekStops, false);\n        //});\n\n\n        $(\"#trip, #attractions\").sortable({\n            start: function(event, ui){\n                startIndex = $(ui.item).parent().children().index(ui.item);\n                console.log(startIndex);\n                startList = $(ui.item).parent().attr(\"id\");\n                console.log(startList);\n            },\n        \tconnectWith: \".sortableList\",\n            stop: function(event, ui){\n                \n                endIndex = $(ui.item).parent().children().index(ui.item);\n                console.log(endIndex);\n                endList = $(ui.item).parent().attr(\"id\");\n                console.log(endList);\n                \n                if (startList !== endList){\n                    if (startList === \"trip\") {\n                        var attr = trekStops.splice(startIndex,1);\n                        suggestedStops.splice(endIndex,0,attr[0]);\n                        $(ui.item).addClass(\"attraction_suggested\");\n                        $(ui.item).removeClass(\"attraction_trip\");\n                    }\n                    else {\n                        var attr = suggestedStops.splice(startIndex,1);\n                        trekStops.splice(endIndex,0,attr[0]);\n                        $(ui.item).addClass(\"attraction_trip\");\n                        $(ui.item).removeClass(\"attraction_suggested\");\n                    }\n                }\n                else {\n                    if (startList === 'trip') {\n                        console.log(\"SORTING TRIP\");\n                        var attr = trekStops.splice(startIndex,1);\n                        trekStops.splice(endIndex,0,attr[0]);\n                    }\n                }\n                \n                getDirections(trekStops, false);\n            }\n\t\t}).disableSelection();\n        \n        //$(\"#trip\").disableSelection();\n        \n        //Map Route Directions\n        getDirections(trekStops, false);\n    }\n}\n\nfunction getDirections(results, optimize){\n\n    var waypts = [];\n    \n    for (var k = 1; k < results.length-1; k++){\n        waypts.push({\n           location: results[k].geometry.location,\n           stopover: true\n        });\n    }\n\n    var request = {\n        origin: results[0].geometry.location,\n        destination: results[results.length-1].geometry.location,\n        travelMode: google.maps.TravelMode.WALKING,\n        waypoints: waypts,\n        optimizeWaypoints: optimize\n    };\n        \n    directionsService.route(request, function(response, status){\n        if (status == google.maps.DirectionsStatus.OK){\n            \n            directionsDisplay.setDirections(response);\n            \n            if (optimize === true) {\n                $(\"#trip\").html('');\n                var temp = [];\n                $(\"#trip\").append('<div class=\"attraction_trip\">' + results[0].name + '</div>');\n                for (var i = 0; i < response.routes[0].waypoint_order.length; i++) {\n                    $(\"#trip\").append('<div class=\"attraction_trip\">' + results[response.routes[0].waypoint_order[i] + 1].name + '</div>');\n                    temp.push(results[response.routes[0].waypoint_order[i] + 1]);\n                }\n                $(\"#trip\").append('<div class=\"attraction_trip\">' + results[results.length-1].name + '</div>');\n                trekStops = temp;                \n            }\n\n        }\n        else {\n            alert(\"Direction Service was not successful for the following reason: \" + status);\n        }\n    });\n}\n\nfunction createMarker(place) {\n    var placeLoc = place.geometry.location;\n    var marker = new google.maps.Marker({\n      map: map,\n      position: placeLoc\n    });\n\n    google.maps.event.addListener(marker, 'mouseover', function() {\n      infowindow.setContent(place.name);\n      infowindow.open(map, this);\n    });\n}\n\ngoogle.maps.event.addDomListener(window, 'load', initialize);"]],"start1":0,"start2":0,"length1":0,"length2":8718}]],"length":8718}
{"contributors":[],"silentsave":true,"ts":1359154306580,"patch":[[{"diffs":[[0,"   \n"],[-1,"        //$(\"#trip\").disableSelection();\n"],[0,"    "]],"start1":6655,"start2":6655,"length1":49,"length2":8}]],"length":8677,"saved":false}
{"ts":1359156090854,"patch":[[{"diffs":[[0,"table({\n"],[1,"            \n"],[0,"        "]],"start1":4930,"start2":4930,"length1":16,"length2":29}]],"length":8690,"saved":false}
{"ts":1359156094650,"patch":[[{"diffs":[[0,"e({\n            "],[1,"revert: function(event,)"],[0,"\n            sta"]],"start1":4934,"start2":4934,"length1":32,"length2":56}]],"length":8714,"saved":false}
{"ts":1359156096371,"patch":[[{"diffs":[[0,"n(event,"],[-1,")"],[1," ui){"],[0,"\n       "]],"start1":4965,"start2":4965,"length1":17,"length2":21}]],"length":8718,"saved":false}
{"ts":1359156097401,"patch":[[{"diffs":[[0,"ion(event, ui){\n"],[1,"                \n            }\n"],[0,"            star"]],"start1":4963,"start2":4963,"length1":32,"length2":63}]],"length":8749,"saved":false}
{"ts":1359156101965,"patch":[[{"diffs":[[0,"  \n            }"],[1,","],[0,"\n            sta"]],"start1":4993,"start2":4993,"length1":32,"length2":33}]],"length":8750,"saved":false}
{"ts":1359156102628,"patch":[[{"diffs":[[0,"{\n              "],[1,"if "],[0,"  \n            }"]],"start1":4977,"start2":4977,"length1":32,"length2":35}]],"length":8753,"saved":false}
{"ts":1359156103879,"patch":[[{"diffs":[[0,"     if "],[1,"()"],[0,"  \n     "]],"start1":4988,"start2":4988,"length1":16,"length2":18}]],"length":8755,"saved":false}
{"ts":1359156109175,"patch":[[{"diffs":[[0,"    if ("],[1,"trekStops.lengt"],[0,")  \n    "]],"start1":4989,"start2":4989,"length1":16,"length2":31}]],"length":8770,"saved":false}
{"ts":1359156109725,"patch":[[{"diffs":[[0,"ps.lengt"],[1,"h"],[0,")  \n    "]],"start1":5004,"start2":5004,"length1":16,"length2":17}]],"length":8771,"saved":false}
{"ts":1359156116277,"patch":[[{"diffs":[[0,"s.length"],[1," >"],[0,")  \n    "]],"start1":5005,"start2":5005,"length1":16,"length2":18}]],"length":8773,"saved":false}
{"ts":1359156123704,"patch":[[{"diffs":[[0,"length >"],[-1,")"],[1," 7){\n                  \n              }"],[0,"  \n     "]],"start1":5007,"start2":5007,"length1":17,"length2":55}]],"length":8811,"saved":false}
{"ts":1359156228688,"patch":[[{"diffs":[[0,"e({\n"],[-1,"            revert: function(event, ui){\n              if (trekStops.length > 7){\n                  \n              }  \n            },\n"],[0,"    "]],"start1":4934,"start2":4934,"length1":142,"length2":8}]],"length":8677,"saved":false}
{"ts":1359156235984,"patch":[[{"diffs":[[0,"= \"trip\") {\n"],[1,"                        \n"],[0,"            "]],"start1":5611,"start2":5611,"length1":24,"length2":49}]],"length":8702,"saved":false}
{"ts":1359156237108,"patch":[[{"diffs":[[0,"                "],[1,"if "],[0,"\n               "]],"start1":5631,"start2":5631,"length1":32,"length2":35}]],"length":8705,"saved":false}
{"ts":1359156238313,"patch":[[{"diffs":[[0,"     if "],[1,"(trek)"],[0,"\n       "]],"start1":5642,"start2":5642,"length1":16,"length2":22}]],"length":8711,"saved":false}
{"ts":1359156243581,"patch":[[{"diffs":[[0,"if (trek"],[1,"Stops.length < "],[0,")\n      "]],"start1":5647,"start2":5647,"length1":16,"length2":31}]],"length":8726,"saved":false}
{"ts":1359156250466,"patch":[[{"diffs":[[0,"ength < "],[1,"8"],[0,")\n      "]],"start1":5662,"start2":5662,"length1":16,"length2":17}]],"length":8727,"saved":false}
{"ts":1359156251867,"patch":[[{"diffs":[[0,"gth < 8)"],[1,"{\n                            \n                        }"],[0,"\n       "]],"start1":5664,"start2":5664,"length1":16,"length2":72}]],"length":8783,"saved":false}
{"ts":1359156316604,"patch":[[{"diffs":[[0,"    "],[-1,"\n                        }\n                        "],[0,"var "]],"start1":5698,"start2":5698,"length1":59,"length2":8},{"diffs":[[0,"(startIndex,1);\n"],[1,"    "],[0,"                "]],"start1":5729,"start2":5729,"length1":32,"length2":36},{"diffs":[[0,"                "],[1," "],[1,"   "],[0,"$(ui.item).addCl"]],"start1":5824,"start2":5824,"length1":32,"length2":36},{"diffs":[[0,"                "],[1,"    "],[0,"$(ui.item).remov"]],"start1":5897,"start2":5897,"length1":32,"length2":36},{"diffs":[[0,"raction_trip\");\n"],[1,"                        } else {\n                            alert(\"Sorry, you are o\")\n                        }\n\n"],[0,"                "]],"start1":5944,"start2":5944,"length1":32,"length2":146}]],"length":8858,"saved":false}
{"ts":1359156317180,"patch":[[{"diffs":[[0,"ou a"],[-1,"re o"],[0,"\")\n "]],"start1":6036,"start2":6036,"length1":12,"length2":8}]],"length":8854,"saved":false}
{"ts":1359156319587,"patch":[[{"diffs":[[0,"ry, you "],[-1,"a"],[1,"can only have "],[0,"\")\n     "]],"start1":6031,"start2":6031,"length1":17,"length2":30}]],"length":8867,"saved":false}
{"ts":1359156323672,"patch":[[{"diffs":[[0,"ly have "],[1,"at most 8 w"],[0,"\")\n     "]],"start1":6045,"start2":6045,"length1":16,"length2":27}]],"length":8878,"saved":false}
{"ts":1359156325786,"patch":[[{"diffs":[[0,"ost "],[-1,"8 w"],[1,"10 "],[0,"\")\n "]],"start1":6057,"start2":6057,"length1":11,"length2":11}]],"length":8878,"saved":false}
{"ts":1359156331970,"patch":[[{"diffs":[[0,"most 10 "],[1,"trek stops."],[0,"\")\n     "]],"start1":6056,"start2":6056,"length1":16,"length2":27}]],"length":8889,"saved":false}
{"ts":1359156333604,"patch":[[{"diffs":[[0,"stops.\")"],[1,";\n                            "],[0,"\n       "]],"start1":6069,"start2":6069,"length1":16,"length2":46}]],"length":8919,"saved":false}
{"ts":1359156345542,"patch":[[{"diffs":[[0,"                "],[1,"$(ui.item)"],[0,"\n               "]],"start1":6091,"start2":6091,"length1":32,"length2":42}]],"length":8929,"saved":false}
{"ts":1359156354180,"patch":[[{"diffs":[[0,"        "],[-1,"$(ui.item)"],[1,"reve"],[0,"\n       "]],"start1":6099,"start2":6099,"length1":26,"length2":20}]],"length":8923,"saved":false}
{"ts":1359156356964,"patch":[[{"diffs":[[0,"    "],[-1,"reve"],[0,"\n   "]],"start1":6103,"start2":6103,"length1":12,"length2":8}]],"length":8919,"saved":false}
